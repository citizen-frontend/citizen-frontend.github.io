import"./password.esm.4b0b8871.js";import{b as V,a as x,c as p}from"./toast.esm.ce455301.js";import{g as N,a0 as R,$ as U,o as C,c as E,b as n,u as o,a as s,V as m,r as _,v as A,p as D,d as k}from"./index.096ac52f.js";import{_ as P,R as y,U as $,S as q}from"./plugin-vue_export-helper.1b5df2d2.js";import{l as B,i as b,u as f,y as w,R as g}from"./index.browser.esm2017.493ab2a2.js";const i=r=>(D("data-v-2201e7fb"),r=r(),k(),r),F={class:"muniform"},Q={class:"container"},H=i(()=>s("div",{style:{width:"100%",padding:"10px"}},[s("h3",null,"Identificarme")],-1)),M={class:"field",style:{width:"100%"}},T=i(()=>s("label",{for:"dni"},"DNI:",-1)),O={class:"field",style:{width:"100%"}},G=i(()=>s("label",{for:"name"},"Nombre:",-1)),j={class:"field",style:{width:"100%"}},J=i(()=>s("label",{for:"question"},"Pregunta secreta:",-1)),L={class:"field",style:{width:"100%"}},z=i(()=>s("label",{for:"answer"},"Respuesta:",-1)),K=i(()=>s("br",null,null,-1)),W={__name:"ForgotPassword",setup(r){const h=N().appContext.config.globalProperties.$firebaseApp,v=B(h),d=R(),e=U({dni:null,name:null,secretQuestion:null,secretAnswer:null}),S=async()=>{if(!e.value.dni){d.add({severity:"error",summary:"MuniHuaura",detail:"Ingresa tu DNI",life:3e3});return}let u=b(w(v,y),f("dni","==",e.value.dni.toString())),t=(await g(u)).docs.map(l=>l.data());if(console.log(t,e.value,e),t.length==0)d.add({severity:"error",summary:"MuniHuaura",detail:"Ciudadano no registrado",life:3e3}),setTimeout(()=>{_.replace({name:"S006"})},3001);else{let l=t[0];e.value.secretQuestion=l.secretQuestion,e.value.name=l.name}},I=async()=>{let u=b(w(v,y),f("dni","==",e.value.dni.toString()),f("secretAnswer","==",btoa(e.value.secretAnswer.toLowerCase()))),t=(await g(u)).docs.map(l=>{let c=l.data();return c.id=l.id,c});if(t.length==0)d.add({severity:"error",summary:"MuniHuaura",detail:"No se encontr\xF3 el ciudadano, reg\xEDstrese",life:3e3});else{let l=t[0];localStorage.setItem($,l.id),sessionStorage.setItem(q,JSON.stringify(l)),d.add({severity:"success",summary:"MuniHuaura",detail:"Bienvenido "+l.name+" "+l.lastName,life:2e3}),setTimeout(()=>{_.push({name:"S002"})},2001)}};return(u,a)=>(C(),E(A,null,[n(o(V),{position:"bottom-left",style:{width:"90%"}}),s("main",F,[s("div",Q,[H,s("div",M,[T,n(o(x),{id:"dni",modelValue:e.value.dni,"onUpdate:modelValue":a[0]||(a[0]=t=>e.value.dni=t),useGrouping:!1,style:{width:"100%"}},null,8,["modelValue"]),n(o(m),{label:"Validar DNI",onClick:S,style:{width:"100%"},class:"p-button-text"})]),s("div",O,[G,n(o(p),{id:"name",disabled:"",type:"text",modelValue:e.value.name,"onUpdate:modelValue":a[1]||(a[1]=t=>e.value.name=t),style:{width:"100%"}},null,8,["modelValue"])]),s("div",j,[J,n(o(p),{id:"question",disabled:"",type:"text",modelValue:e.value.secretQuestion,"onUpdate:modelValue":a[2]||(a[2]=t=>e.value.secretQuestion=t),style:{width:"100%"}},null,8,["modelValue"])]),s("div",L,[z,n(o(p),{id:"question",type:"text",modelValue:e.value.secretAnswer,"onUpdate:modelValue":a[3]||(a[3]=t=>e.value.secretAnswer=t),style:{width:"100%"}},null,8,["modelValue"])]),K,n(o(m),{onClick:I,label:"Identificarme",style:{width:"100%"}}),n(o(m),{onClick:a[4]||(a[4]=t=>o(_).go(-1)),label:"Regresar",class:"p-button-outlined p-button-info",style:{width:"100%"}})])])],64))}};var ae=P(W,[["__scopeId","data-v-2201e7fb"]]);export{ae as default};
